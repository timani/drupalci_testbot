# https://circleci.com/docs/configuration#machine
machine:
  php:
    # https://circleci.com/docs/environment#php
    version: 5.3.10
  environment:
    PUUID: 'ed64345a-aa95-4e9e-b919-1fe9e8537ce6' 
  services:
    - docker
    
dependencies:
  pre: 
    # Install Drush 
    - composer global require drush/drush:6.2.0 

  # Install additional test dependencies here (like Casper, Behat, etc).
  override:  
    # Authenticate with Pantheon via Terminus.
    - drush pauth $PEMAIL --password=$PPASS
 
    # Build the Upstream repo for testing with drush make 
    # If you're using SimpleTest, you'll want to disable verbose logging. This
    # ensures no false build failures from file write errors.
    - drush @pantheon.$PNAME.$PSITE vset -y simpletest_verbose 0 --strict=0
 
test:
  override:
    #
    # This is where you run your tests, be they SimpleTest, Casper, Behat,
    # or otherwise. Here's a SimpleTest example. I've found that drush
    # likes to exit with odd codes if you run multiple classes at once.
    # You may have to run one class at a time.
    #
    - drush @pantheon.$PNAME.$PSITE test-run MyTestClass --strict=0
    - drush @pantheon.$PNAME.$PSITE test-run MyTestClass2 --strict=0
 
  post:
  # Destroy the Pantheon environment
  - drush psite-edelete $PUUID $PSITE -y
